<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desk control</title>
    <style>
        /* Add some styling for better layout */
        body {
            font-family: Arial, sans-serif;
            margin-bottom: 20px;
            background-color: #e0e0e0; /* Light blue background */
        }
		
		button {
			margin-bottom: 7px;
			height:20px;
			width:70px;
		}
		
		input {
			margin-right: 5px;
			margin-bottom: 7px;
		}
		
		label {
			margin-bottom: 10px;
		}

		table {
			table-layout: fixed;
			width: 150px;
			margin-bottom: 5px;
		}

        h1 {
            margin-bottom: 10px;
            color: #333; /* Dark text color */
			font-size: 28px
        }

        h2 {
            margin-bottom: 10px;
            color: #333; /* Dark text color */
			font-size: 20px
        }

    </style>
</head>
<body onload="reload()">

	<h1>Awesome Desk Controller &reg;</h1>

    <h2>Drive manual</h2>
	<div id="driveManual">
		<button onclick="driveDirection('up')" style="width: 100px; height: 25px">&uarr;</button>
		<br>
		<button onclick="driveStop()" style="width: 100px; height: 25px">--</button>
		<br>
		<button onclick="driveDirection('down')" style="width: 100px; height: 25px">&darr;</button>
	</div>
	
    <h2>Drive to</h2>
	<div id="driveTo">
		<input type="text" id="driveToEntry">
		<button onclick="driveTo(-1)">Go</button>
	</div>
	
    <h2>Presets</h2>
    <div id="presetsColumn">
    </div>
    <button onclick="savePresets()" style="margin-top: 10px; width: 100px">Save</button>
	
    <h2>Calibration</h2>
    <div>
		<table>
			<tr>
				<td><label for="heightEntry">Height:</label></td>
				<td><input type="text" id="heightEntry"></td>
			</tr>
		</table>
        <button onclick="saveCalibration()" style="width: 100px">Save</button>
    </div>

    <h2>Network</h2>
    <div id="networkSection">
		<table>
			<tr>
				<td><label for="wifiSsidEntry">Wifi ssid:</label></td>
				<td><input type="text" id="wifiSsidEntry"></td>
			</tr>
			<tr>
				<td><label for="wifiPassEntry">Wifi pass:</label></td>
				<td><input type="password" id="wifiPassEntry"></td>
			</tr>
			<tr>
				<td><label for="ipEntry">IP:</label></td>
				<td><input type="text" id="ipEntry"></td>
			</tr>
			<tr>
				<td><label for="subnetEntry">Subnet:</label></td>
				<td><input type="text" id="subnetEntry"></td>
			</tr>
		</table>
		<button onclick="saveNetwork()" style="width: 100px">Save</button>
    </div>

    <script>
		var IP_ADDR = "http://192.168.0.115"
	
        function reload() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', IP_ADDR + '/health', true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var data = JSON.parse(xhr.responseText);
                    updateUI(data);
                }
            };
            xhr.send();
        }

        function updateUI(data) {
            document.getElementById('heightEntry').value = data.height;
            document.getElementById('wifiSsidEntry').value = data.wifiSsid;
            document.getElementById('wifiPassEntry').value = data.wifiPass;
            document.getElementById('ipEntry').value = data.ip;
            document.getElementById('subnetEntry').value = data.subnet;
			
			var presetsColumn = document.getElementById('presetsColumn');
			var presetCnt = data.presetsCount;
			var presets = data.presets;

            presetsColumn.innerHTML = '';
			
			for(let i = 0; i < presetCnt; i++)
			{
                var entry = document.createElement('input');
                entry.type = 'text';
			
				if(i < presets.length)
				{
					entry.value = presets[i];
					
					var goButton = document.createElement('button');
					goButton.innerText = 'Go';
					goButton.style = "margin-left: 5px"
					goButton.onclick = function () {
						driveTo(i);
					};
				}
				
				presetsColumn.appendChild(entry);
				
				if(i < presets.length)
				{
					presetsColumn.appendChild(goButton);
				}
				
				presetsColumn.appendChild(document.createElement('br'));
			}
        }

        function savePresets() {
            var entries = document.querySelectorAll('#presetsColumn input');
            var presets = [];

            entries.forEach(function (entry) {
                presets.push(parseFloat(entry.value));
            });

            var xhr = new XMLHttpRequest();
            xhr.open('POST', IP_ADDR + '/config', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    console.log('Presets saved successfully.');
                }
            };

            xhr.send(JSON.stringify({ presets: presets }));
        }

        function driveTo(source) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', IP_ADDR + '/drive/height', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    console.log('Height preset sent successfully.');
                }
            };

            xhr.send(JSON.stringify({ height: height }));
        }

        function driveDirection(direction) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', IP_ADDR + '/drive/direction', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    console.log('Direction sent successfully.');
                }
            };

            xhr.send(JSON.stringify({ direction: direction }));
        }

        function driveStop() {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', IP_ADDR + '/drive/stop', true);

            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    console.log('Drive stopped successfully.');
                }
            };

            xhr.send();
        }

        function saveCalibration() {
            var heightVal = document.getElementById('calibrateHeight').value;

            var xhr = new XMLHttpRequest();
            xhr.open('POST', IP_ADDR + '/calibration', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    console.log('Calibration saved successfully.');
                }
            };

            xhr.send(JSON.stringify({ height: parseFloat(heightVal) }));
        }

        function saveNetwork() {
            var wifiSsid = document.getElementById('wifiSsid').value;
            var wifiPass = document.getElementById('wifiPass').value;
            var ip = document.getElementById('ip').value;
            var subnet = document.getElementById('subnet').value;

            var xhr = new XMLHttpRequest();
            xhr.open('POST', IP_ADDR + '/config', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    console.log('Network configuration saved successfully.');
                }
            };

            xhr.send(JSON.stringify({ wifiSsid: wifiSsid, wifiPass: wifiPass, ip: ip, subnet: subnet }));
        }
    </script>

</body>
</html>
